
create table historial_de_estado (
	id int auto_increment primary key,
    fecha_cambio datetime not null,
    observacion varchar(255) not null
);

create table usuarios (
	id int auto_increment primary key,
    email varchar(255) not null,
    contrasena varchar(255) not null default "abcd",
    nombre varchar(255) not null,
    rol enum('admin','profesor') not null,
    cedula varchar(255) not null default "101230456",
    grupo_profesional varchar(255) not null,
    puesto varchar(255) not null,
    condicion varchar(255) not null
); 


create table omision (
	id int auto_increment primary key,
    nombre varchar(255) not null,
    id_profesor int not null,
	rol enum('admin','profesor') not null,
	instancia enum('Personal docente','Titulo II','Personal administrativo','Titulo I'),
    estado enum('pendiente', 'aprobado', 'rechazado') not null default 'pendiente',
    fecha_evento date not null,
    entrada time not null,
    salida time not null,
	tipo_omision enum("Todo el dia", "Salida anticipada") not null,
    justificacion varchar(255),
    resolucion enum('Aceptar lo solicitado','Denegar lo solicitado','Acoger convocatoria'),
    motivo_resolucion varchar(255)
);

create table solicitud_salida (
	id int auto_increment primary key,
    nombre varchar(255) not null,
    cedula varchar(255) not null,
	rol enum('admin','profesor') not null,
    condicion enum('propietario','interino'),
    grupo_profesional varchar(255),
    fecha date,
    fecha_evento date,
    hora_inicio time not null,
    hora_fin time not null,
    total_lecciones int not null,
    jornada enum('mañana','tarde'),
    motivo varchar(255) not null,
    observaciones varchar(255) not null,
    tipo_firma text,
    nombre_firma varchar(255),
    firma longblob,
    hora_presentado time,
    mes enum('enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre')
);

create table justificacion (
	id int auto_increment primary key,
    nombre_prof varchar(255) not null,
    id_profesor int not null,
	total_lecciones int not null,
    tipo_justificacion enum('ausencia', 'tardia') not null,
    estado enum('pendiente', 'aprobado', 'rechazado') not null default 'pendiente',
    fecha date,
    fecha_evento date,
    fecha_revision datetime,
    hora_inicio datetime not null,
    hora_final datetime not null,
    comprobante boolean not null,
    horario enum('mañana', 'tarde'),
    jornada enum('jornada completa', 'media jornada') not null,
    lecciones float not null,
    horas float not null,
    motivo varchar(255) not null,
    solicitud_a_tiempo boolean not null,
    justificacion_permiso varchar(255) not null,
    observaciones varchar(255) not null,
    resolucion enum('Aceptar lo solicitado','Denegar lo solicitado','Acoger convocatoria'),
    motivo_resolucion varchar(255),
    foreign key (id_profesor) references usuarios(id)
);

create database bd_ctpmn;
use bd_ctpmn;
select * from solicitud_salida;
delete from solicitud_salida;